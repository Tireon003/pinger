services:
  redis:
    image: redis:7.4-alpine
    ports:
      - "6379:6379"
    restart: on-failure
    env_file: .env

  pinger_db:
    image: postgres:17.0-alpine
    environment:
      POSTGRES_DB: ${DB_NAME}
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASS}
    ports:
       - ${DB_PORT}:5432
    restart: on-failure
    env_file: .env
    volumes:
      - ./pinger_db:/var/lib/postgresql/data

  pinger_server:
    build:
      context: .
      dockerfile: server/Dockerfile
    ports:
      - "8228:8228"
    depends_on:
      - redis
      - pinger_db
    restart: on-failure
    env_file: .env

  pinger_client:
    build:
      context: .
      dockerfile: client/Dockerfile
    depends_on:
      - pinger_server
    restart: on-failure
    env_file: .env

volumes:
  pinger_db: